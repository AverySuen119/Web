<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Animal Welfare Events — Home</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <!-- 导航 -->
  <header class="header">
    <div class="container">
      <h1>Animal Welfare Events</h1>
      <p class="tagline">Our Mission: Caring for animals, rescuing abandoned pets, and promoting adoption. Contact: info@pawswhiskers.org</p>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/search.html">Search Events</a>
      </nav>
    </div>
  </header>

  <!-- 主要内容 -->
  <main class="container">
    <section class="events-section">
      <h2>Upcoming Events</h2>
      <div id="events-container" class="cards">
        <!-- JS 注入活动卡片 -->
      </div>
      <div id="events-empty" class="empty" hidden>No upcoming events found.</div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="footer">
    <div class="container">
      <p>© 2025 Animal Welfare Foundation • Address: 10 Charity St, Petville</p>
    </div>
  </footer>

  <!-- JS 动态加载事件 -->
  <script type="module">
    import { getEvents } from './js/api.js';

    async function renderHome() {
      const container = document.getElementById('events-container');
      const emptyEl = document.getElementById('events-empty');

      container.innerHTML = '<p class="loading">Loading events…</p>';

      try {
        const events = await getEvents({ upcoming: true, limit: 12 });
        container.innerHTML = '';
        if (!Array.isArray(events) || events.length === 0) {
          emptyEl.hidden = false;
          return;
        }
        emptyEl.hidden = true;

        events.forEach(ev => {
          const card = document.createElement('article');
          card.className = 'card';

          const evDate = new Date(ev.event_date);
          const dateStr = evDate.toLocaleString();
          const priceText = ev.is_free ? 'Free' : ('$' + Number(ev.price).toFixed(2));

          card.innerHTML = `
            <h3 class="card-title">${ev.name}</h3>
            <p class="meta"><strong>Category:</strong> ${ev.category_name} • <strong>Date:</strong> ${dateStr}</p>
            <p class="meta"><strong>Location:</strong> ${ev.location_name || 'TBA'}</p>
            <p class="desc">${ev.short_desc || ''}</p>
            <div class="card-footer">
              <span class="price">${priceText}</span>
              <button class="btn" onclick="window.location.href='/event.html?id=${ev.event_id}'">View Details</button>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error('Failed to load events', err);
        container.innerHTML = '<p class="error">Failed to load events. Please make sure the server is running.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', renderHome);
  </script>
</body>
</html>
